# This references a standard debian container from the
# Docker Hub https://registry.hub.docker.com/_/debian/
# Read more about containers on our dev center
# http://devcenter.wercker.com/docs/containers/index.html
box: debian
# This is the build pipeline. Pipelines are the core of wercker
# Read more about pipelines on our dev center
# http://devcenter.wercker.com/docs/pipelines/index.html
build:
  # Steps make up the actions in your pipeline
  # Read more about steps on our dev center:
  # http://devcenter.wercker.com/docs/steps/index.html
  steps:
    - install-packages:
        packages: git make
    - script:
        name: clone firmware
        code: |
          git clone https://github.com/jackhumbert/qmk_firmware.git
          ln -s $WERCKER_SOURCE_DIR qmk_firmware/keyboards/ergodox/keymaps/target_keymap
    - script:
        name: build keymap
        cwd: $WERCKER_SOURCE_DIR
        code: |
          make keyboard=ergodox keymap=target_keymap
deploy:
  steps:
    - script:
        name: put built hex file to bintray.
        code: |
          curl -T $WERCKER_SOURCE_DIR/ergodox_ez_target_keymap.hex -u$BINTRAY_USERNAME:$BINTRAY_APIKEY https://api.bintray.com/content/$BINTRAY_USERNAME/$BINTRAY_REPO/$BINTRAY_PACKAGE/$WERCKER_GIT_BRANCH-$WERCKER_GIT_COMMIT/ergodox.hex
    - script:
        name: publish uploaded hex file.
        code: |
          curl -X POST -u$BINTRAY_USERNAME:$BINTRAY_APIKEY https://api.bintray.com/content/$BINTRAY_USERNAME/$BINTRAY_REPO/$BINTRAY_PACKAGE/$WERCKER_GIT_BRANCH-$WERCKER_GIT_COMMIT/publish
